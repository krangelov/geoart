<html>
	<head>
		<script src="geoart.js"></script>
		<script>
			function onLoad() {
				var a = new Point(400,400);
				var b = new Point(150,250);

				var canvas = document.getElementById("myCanvas");
				var code   = document.getElementById("myCode");
				canvas.state = {};
				canvas.state.points = [a,b]
				canvas.state.focus  = null;

				onCodeChange(code, canvas);
			}
			
			function onDraw() {
				var canvas = document.getElementById("myCanvas");
				var ctx = canvas.getContext("2d");
				ctx.clearRect(0, 0, canvas.width, canvas.height);
				canvas.code(ctx,canvas.state.points);
			}

			function onMouseDown(canvas,event) {
				for (var i in canvas.state.points) {
					var point = canvas.state.points[i];
					if (point.isHit(event.offsetX,event.offsetY)) {
						canvas.state.focus = point;
						break;
					}
				}
			}
			
			function onMouseMove(canvas,event) {
				if (canvas.state.focus != null) {
					canvas.state.focus.x = event.offsetX;
					canvas.state.focus.y = event.offsetY;
					onDraw();
				}
			}
			
			function onMouseUp(canvas,event) {
				canvas.state.focus = null;
			}
			
			function onCodeChange(code, canvas) {
				try {
					eval("canvas.code = function(ctx,points) {"+code.value+"}");
					onDraw();
				} catch (e) {
					//alert(e.message);
				}
			}
		</script>
	</head>
	<body onload="onLoad()">
		<table>
			<tr>
				<td>
					<textarea id="myCode" style="height: 900px; width: 400px" oninput="onCodeChange(this,document.getElementById('myCanvas'))">
[p1,p2] = points;

var c0 = new Circle(p1,p2);
var c1 = new Circle(p2,p1);

[p3,p4] = c1.intersect(c0);
var c2 = new Circle(p3,p1);

[p4,p5] = c2.intersect(c0);
var c3 = new Circle(p4,p1);

[p6,p7] = c3.intersect(c0);
var c4 = new Circle(p6,p1);

[p8,p9] = c4.intersect(c0);
var c5 = new Circle(p8,p1);

[p10,p11] = c5.intersect(c0);
var c6 = new Circle(p10,p1);

var l1  = new Line(p1,p2);
var l2  = new Line(p1,p3);
var l3  = new Line(p1,p4);
var l4  = new Line(p1,p5);
var l5  = new Line(p1,p6);
var l6  = new Line(p1,p8);
var l7  = new Line(p1,p10);
var l8  = new Line(p2,p4);
var l9  = new Line(p4,p8);
var l10 = new Line(p8,p2);
var p11 = l8.intersect(l2);
var p12 = l9.intersect(l4);
var p13 = l10.intersect(l3);
var c7  = new Circle(p2,p11);
var c8  = new Circle(p4,p12);
var c9  = new Circle(p8,p13);
var [p14,p15] = l1.intersect(c7);
var [p16,p17] = l3.intersect(c8);
var [p18,p19] = l6.intersect(c9);
var c10 = new Circle(p1,p14);
var a1  = new Arc(p2,p14,p13);
var a2  = new Arc(p4,p16,p11);
var a3  = new Arc(p8,p18,p12);

p1.draw(ctx);
p2.draw(ctx);
/*c0.draw(ctx);
c1.draw(ctx);
c2.draw(ctx);
c3.draw(ctx);
c4.draw(ctx);
c5.draw(ctx);
c6.draw(ctx);
l1.draw(ctx);
l2.draw(ctx);
l3.draw(ctx);
l4.draw(ctx);
l5.draw(ctx);
l6.draw(ctx);
l7.draw(ctx);
l8.draw(ctx);
l9.draw(ctx);
l10.draw(ctx);
p11.draw(ctx);
p12.draw(ctx);
p13.draw(ctx);
p14.draw(ctx);
c7.draw(ctx);
c8.draw(ctx);
c9.draw(ctx);
p17.draw(ctx);*/
a1.draw(ctx);
a2.draw(ctx);
a3.draw(ctx);
c10.draw(ctx);
					</textarea>
				</td>
				<td>
					<canvas id="myCanvas" width="1500" height="900", onmousedown="onMouseDown(this,event)" onmousemove="onMouseMove(this,event)" onMouseUp="onMouseUp(this,event)">
					</canvas>
				</td>
			</tr>
		</table>
	</body>
</html>

